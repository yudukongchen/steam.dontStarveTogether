local XL_={Asset("ATLAS","images/hud/tardis_ui.xml"),Asset("ANIM","anim/tardis_pointer.zip"),Asset("SOUNDPACKAGE","sound/tardis_sfx.fev"),Asset("SOUND","sound/tardis_sfx.fsb")}for mP3mlD,PrPyxMK in ipairs(XL_)do table.insert(Assets,PrPyxMK)end;local WYdR=require"screens/tardis_console_screen"AddPrefabPostInit("hua_wall_decals_zhu2",function(tczrIB)if not tczrIB.SoundEmitter then tczrIB.entity:AddSoundEmitter()end;if TheWorld.ismastersim then tczrIB:AddComponent("ta_console")end end)AddPlayerPostInit(function(a)a._ta_center_x=net_float(a.GUID,"_ta_center_x","_ta_center_x_dirty")a._ta_center_y=net_float(a.GUID,"_ta_center_y","_ta_center_y_dirty")a._ta_pushscreen_event=net_event(a.GUID,"_ta_pushscreen_event")a:DoTaskInTime(0,function(a)if a~=ThePlayer then return end;a:ListenForEvent("_ta_pushscreen_event",function()TheFrontEnd:PushScreen(WYdR())end)end)end)local function QKKks_zt(wqU76o,LB1Z)local N9L,hDc_M,qW0lRiD1=wqU76o:Get()for iD1IUx,JLCOx_ak in ipairs(TheSim:FindEntities(N9L,hDc_M,qW0lRiD1,16,{"hua_door"}))do local hPQ=JLCOx_ak.components.hua_teleporter and JLCOx_ak.components.hua_teleporter.targetTeleporter;if hPQ and hPQ:IsValid()then if(not LB1Z)or(LB1Z==hPQ._ownerid)then return hPQ end end end end;local function Are7xU(R1FIoQI)local NsoTwDs,HGli,iy=R1FIoQI:Get()for m6SCS0,NUhYw6R4 in ipairs(TheSim:FindEntities(NsoTwDs,HGli,iy,16))do if NUhYw6R4.prefab=='hua_wall_decals_zhu2'then return NUhYw6R4 end end end;local yxjl=Action({priority=1,mount_valid=true})yxjl.id="TA_TELEPORT"yxjl.str="操作"yxjl.fn=function(Hv)local Ch=QKKks_zt(Hv.target:GetPosition(),Hv.doer.userid)if Ch then local urkh=Ch:GetPosition()if Hv.doer._ta_center_x and Hv.doer._ta_center_y then Hv.doer._ta_center_x:set(urkh.x)Hv.doer._ta_center_y:set(urkh.z)end;if Hv.doer._ta_pushscreen_event then Hv.doer._ta_pushscreen_event:push()end;return true else if Hv.doer.components.talker then Hv.doer.components.talker:Say("这台设备有指纹锁!")end;return true end end;AddAction(yxjl)AddStategraphActionHandler("wilson",ActionHandler(yxjl,"give")) AddStategraphActionHandler("wilson_client",ActionHandler(yxjl,"give"))AddComponentAction("SCENE","ta_console",function(zhzpBSx,rHSjalVy,TjhsnP)table.insert(TjhsnP,yxjl)end)local function ZG(t5jzEd9,JZAU2,zPXTTg)if type(JZAU2)=="number"and type(zPXTTg)=="number"then local seMLr=QKKks_zt(t5jzEd9:GetPosition())if seMLr and seMLr.DoTeleport then seMLr:DoTeleport(Point(JZAU2,0,zPXTTg))end end end;AddModRPCHandler("huahouse_name","ta_teleport",ZG)local Vu0cCAf=Class(function(qX,h_8,xL7OTb)qX.time=h_8;qX.fn=xL7OTb end)local q={{0.0,1.0},{1.0,0.3},{1.0,0.8},{0.8,0.2},{0.8,0.6},{0.8,0.1},{0.8,0.5},{0.8,0.0},{0.9,0.4},{0.8,0.0}}local kP7O5={{0.0,0.0},{0.8,0.0},{1.0,0.6},{0.8,0.2},{0.9,0.9},{0.8,0.3},{0.9,1.0},{0.8,0.4},{0.8,1.0},{0.8,0.4},{0.9,1.0},{0.9,0.4},{0.5,1.0}}local function lqT(w8T3f,K)local qL,vfIyB;qL=w8T3f.components.hua_teleporter.targetTeleporter;if qL~=nil then vfIyB=Are7xU(qL:GetPosition())end;local quNsijN=w8T3f:GetPosition()local QUh2tc=SpawnPrefab("hua_player_house_tardis_fake")QUh2tc.Transform:SetPosition(K:Get())QUh2tc.AnimState:SetMultColour(0,0,0,0)QUh2tc.SoundEmitter:PlaySound("tardis_sfx/sfx/out_2",nil,1)w8T3f.components.hua_teleporter.enabled=false;if w8T3f.components.workable then w8T3f.components.workable:SetWorkable(false)end;w8T3f.components.inspectable.getspecialdescription=function()return STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PLAYER_HOUSE_TARDIS_TELEPORTING end;if qL then qL.components.hua_teleporter.enabled=false end;local function qboV(w8T3f,u)local Ki1=0;if not w8T3f.fadeout_task then w8T3f.fadeout_task=w8T3f:DoPeriodicTask(0,function()Ki1=Ki1+1/30;local zz1QI,kFTAh,LBf=Ki1,nil;for dijn4Ph,CO1 in ipairs(u)do zz1QI=zz1QI-CO1[1]if zz1QI<0 then kFTAh,LBf=u[ dijn4Ph-1],u[dijn4Ph]local RlZo=Remap(zz1QI+LBf[1],0,LBf[1],kFTAh[2],LBf[2])w8T3f.AnimState:SetMultColour(RlZo,RlZo,RlZo,RlZo)w8T3f.Light:SetIntensity(RlZo*.85)w8T3f._ta_window_alpha:set(RlZo)break end end;if not kFTAh then w8T3f.fadeout_task:Cancel()w8T3f.fadeout_task=nil;return end end)end end;qboV(w8T3f,q)qboV(QUh2tc,kP7O5) local nSBOx7={Vu0cCAf(0.0,function()w8T3f.SoundEmitter:PlaySound("tardis_sfx/sfx/out_1",nil,1)end),Vu0cCAf(9.75,function()w8T3f.Transform:SetPosition(K:Get())w8T3f.AnimState:SetMultColour(1,1,1,1)w8T3f.Light:SetIntensity(.85)w8T3f._ta_window_alpha:set(-100)end),Vu0cCAf( 9.75+FRAMES,function()QUh2tc:Hide()end),Vu0cCAf(12,function()QUh2tc:Remove()end),Vu0cCAf(0.3,function()if vfIyB then vfIyB.SoundEmitter:PlaySound("tardis_sfx/sfx/in",nil,1)end end),Vu0cCAf(10.0,function()if qL then qL.components.hua_teleporter.enabled=true end;if w8T3f.components.workable then w8T3f.components.workable:SetWorkable(true)end;w8T3f.components.hua_teleporter.enabled=true;w8T3f.components.inspectable.getspecialdescription=nil;for SUn,Ib4 in pairs(AllPlayers)do if Ib4.userid==w8T3f._ownerid and Ib4.player_classified~=nil then Ib4.player_classified.MapExplorer:RevealArea(quNsijN:Get())Ib4.player_classified.MapExplorer:RevealArea(K:Get())break end end end)}for fjV1G2,Do in ipairs(nSBOx7)do w8T3f:DoTaskInTime(Do.time,Do.fn)end end;if false then local _=c_spawn("hua_player_house_tardis")_:DoPeriodicTask(20,function()_:DoTeleport(_:GetPosition()+Vector3(10,0,0))end,0)end;AddPrefabPostInit("hua_player_house_tardis",function(TqYJ4)if TheWorld.ismastersim then TqYJ4.DoTeleport=lqT else end end)