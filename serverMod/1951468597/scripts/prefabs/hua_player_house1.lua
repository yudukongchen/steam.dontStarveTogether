require"prefabutil"local q={Asset("ANIM","anim/hua_house1.zip"),Asset("ANIM","anim/hua_house1_window.zip")}local kP7O5={"collapse_small","hua_floor","hua_door_exit1","hua_wall","hua_house"}SetSharedLootTable('hua_player_house1',{{'gears',1.00},{'gears',1.00},{'transistor',1.00},{'transistor',1.00},{'cutstone',1.00},{'cutstone',1.00},{'cutstone',1.00}})local function lqT(HGli,iy)if iy~=nil and iy:HasTag("player")then end end;local function mP3mlD(m6SCS0,NUhYw6R4)if NUhYw6R4:HasTag("player")then elseif m6SCS0.SoundEmitter~=nil then end end;local function PrPyxMK(Hv,Ch)end;local function tczrIB(urkh,zhzpBSx)urkh.components.lootdropper:DropLoot()local rHSjalVy=SpawnPrefab("collapse_big")rHSjalVy.Transform:SetPosition(urkh.Transform:GetWorldPosition())rHSjalVy:SetMaterial("metal")urkh:Remove()end;local function a(TjhsnP,t5jzEd9)if not TheWorld.components.huahouse or TheWorld.components.huahouse:IsMax()then if t5jzEd9 and t5jzEd9.builder and t5jzEd9.builder.components.talker then t5jzEd9.builder.components.talker:Say(STRINGS.HUAHOUSEMAX)end;return end;local JZAU2,zPXTTg=TheWorld.components.huahouse:GetPosition()if not(JZAU2 and zPXTTg)then if t5jzEd9 and t5jzEd9.builder and t5jzEd9.builder.components.talker then t5jzEd9.builder.components.talker:Say(STRINGS.HUAHOUSEMAX)end;return end;local seMLr=SpawnPrefab("hua_house") seMLr.Transform:SetPosition(JZAU2,0,zPXTTg)SpawnPrefab("hua_light_red1").Transform:SetPosition(JZAU2+2.21,0,zPXTTg)SpawnPrefab("hua_window_punk").Transform:SetPosition(JZAU2-6.5,0.2,zPXTTg+3.66)local qX=SpawnPrefab("hua_door_exit1")qX.Transform:SetPosition(JZAU2+7.5,0,zPXTTg)local h_8=SpawnPrefab("hua_floor")h_8.Transform:SetPosition(JZAU2-6.8,0,zPXTTg)if h_8.SetHouseWallSkin~=nil then h_8.SetHouseWallSkin(h_8,"hua_floorskin_punk")end;local xL7OTb=SpawnPrefab("hua_wallpaper")xL7OTb.Transform:SetPosition(JZAU2,0,zPXTTg)if xL7OTb.SetHouseWallSkin~=nil then xL7OTb.SetHouseWallSkin(xL7OTb,"hua_wallskin_punk")end;qX.components.hua_teleporter:Target(TjhsnP)TjhsnP.components.hua_teleporter:Target(qX)local function w8T3f(JZAU2,zPXTTg)local nSBOx7=SpawnPrefab("hua_wall")if nSBOx7 ~=nil then nSBOx7.Physics:SetCollides(false)nSBOx7.Physics:Teleport(JZAU2,0,zPXTTg)nSBOx7.Physics:SetCollides(true)end end;for u=-10,10 do w8T3f(JZAU2-6.8,zPXTTg+u)end;for Ki1=-12,11 do w8T3f(JZAU2+8.3,zPXTTg+Ki1)end;local K=0;for zz1QI=-6.2,6.8 do w8T3f(JZAU2+zz1QI,zPXTTg-11-K)K=K+0.11 end;local qL=0;for kFTAh=-6.2,6.8 do w8T3f(JZAU2+kFTAh,zPXTTg+11+qL)qL=qL+0.09 end;local vfIyB=SpawnPrefab("hua_wall_decals1")vfIyB.Transform:SetPosition(JZAU2+7.53,0,zPXTTg-12.07)local quNsijN=SpawnPrefab("hua_wall_decals1")quNsijN.Transform:SetPosition(JZAU2+7.53,0,zPXTTg+11.77)quNsijN.AnimState:SetScale(-1,1,1)quNsijN.eastside=true;local QUh2tc=SpawnPrefab("hua_wall_decals1_in")QUh2tc.Transform:SetPosition(JZAU2-5.83,0,zPXTTg-10.34) local qboV=SpawnPrefab("hua_wall_decals1_in")qboV.Transform:SetPosition(JZAU2-5.83,0,zPXTTg+9.77)qboV.AnimState:SetScale(-1,1,1)qboV.eastside=true;TheWorld.components.huahouse:BuildHouse()if t5jzEd9 and t5jzEd9.builder and t5jzEd9.builder.userid~=nil then TjhsnP._ownerid=t5jzEd9.builder.userid end end;local wqU76o={251/255,248/255,103/255}local function LB1Z(LBf,dijn4Ph)if dijn4Ph=="night"then LBf.Light:Enable(true)else LBf.Light:Enable(false)end end;local function N9L(CO1,RlZo)if RlZo=="night"then if CO1._window~=nil then CO1._window:Show()end else if CO1._window~=nil then CO1._window:Hide()end end end;local function hDc_M()local SUn=CreateEntity("Huahouse1.MakeWindow")SUn.entity:AddTransform()SUn.entity:AddAnimState()SUn:AddTag("DECOR")SUn:AddTag("NOCLICK")SUn.persists=false;SUn.AnimState:SetBank("hua_house1") SUn.AnimState:SetBuild("hua_house1_window")SUn.AnimState:PlayAnimation("idle",true)SUn.AnimState:SetLightOverride(.4)SUn.AnimState:SetBloomEffectHandle("shaders/anim.ksh")SUn.AnimState:SetFinalOffset(1)SUn:Hide()return SUn end;local function qW0lRiD1(Ib4,fjV1G2,Do,_,TqYJ4)if Ib4:HasTag("player")then Ib4:ScreenFade(false)Ib4:DoTaskInTime(1,function()Ib4:SnapCamera()Ib4:ScreenFade(true,0.5)end)end;if Ib4.Transform~=nil then Ib4.Transform:SetPosition(fjV1G2,Do,_)end;if TqYJ4 then Ib4:DoTaskInTime(0.2,function(Ib4)if Ib4 and Ib4:IsValid()and Ib4:HasTag("player")and Ib4.components.health~=nil and not Ib4.components.health:IsDead()then Ib4.components.health:Kill()end end)end end;local function iD1IUx(DI,b)b._ownerid=DI._ownerid or nil end;local function JLCOx_ak(E,KMw7_i1s)if KMw7_i1s and KMw7_i1s._ownerid~=nil then E._ownerid=KMw7_i1s._ownerid end end local function hPQ(CQi)CQi.inst.name=CQi.nameformat~=nil and string.format(CQi.nameformat,CQi.name)or CQi.name;CQi.inst.replica.named:SetName(CQi.inst.name,"")end local function R1FIoQI()local nHlJ=CreateEntity()nHlJ.entity:AddTransform()nHlJ.entity:AddAnimState()nHlJ.entity:AddSoundEmitter()nHlJ.entity:AddMiniMapEntity()nHlJ.entity:AddNetwork()nHlJ.entity:AddLight()nHlJ.MiniMapEntity:SetIcon("hua_player_house1.tex")nHlJ.AnimState:SetBank("hua_house1")nHlJ.AnimState:SetBuild("hua_house1")nHlJ.AnimState:PlayAnimation("idle",true)nHlJ.Transform:SetScale(0.9,0.9,0.9)nHlJ:AddTag("hua_door")nHlJ:AddTag("shelter")nHlJ:AddTag("antlion_sinkhole_blocker")nHlJ:AddTag("nonpackable")nHlJ:AddTag("lightningrod")nHlJ:AddTag("hua_house_named")nHlJ:AddTag("_named")MakeObstaclePhysics(nHlJ,1.2)MakeSnowCoveredPristine(nHlJ)nHlJ.Light:SetFalloff(.5)nHlJ.Light:SetIntensity(.85)nHlJ.Light:SetRadius(1.5)nHlJ.Light:SetColour(unpack(wqU76o))if not TheNet:IsDedicated()then nHlJ._window=hDc_M()nHlJ._window.entity:SetParent(nHlJ.entity)nHlJ:WatchWorldState("phase",N9L)N9L(nHlJ,TheWorld.state.phase)end;nHlJ.entity:SetPristine()if not TheWorld.ismastersim then return nHlJ end;nHlJ:RemoveTag("_named")nHlJ.AnimState:SetTime(math.random()*nHlJ.AnimState:GetCurrentAnimationLength())if nHlJ._window~=nil then nHlJ._window.AnimState:SetTime(nHlJ.AnimState:GetCurrentAnimationTime())end;nHlJ:AddComponent("inspectable")nHlJ:AddComponent("named")nHlJ.components.named.housename=nil nHlJ.components.named.OnSave=function(lw4Q7kbl)return lw4Q7kbl.housename~=nil and{housename=lw4Q7kbl.housename,nameformat=lw4Q7kbl.nameformat}or nil end;nHlJ.components.named.OnLoad=function(IN,QYf1)if QYf1 ~=nil and QYf1.housename~=nil then IN.nameformat=QYf1.nameformat;IN.name=QYf1.housename;IN.housename=QYf1.housename;hPQ(IN)end end;nHlJ:AddComponent("hua_teleporter")nHlJ.components.hua_teleporter.onActivate=mP3mlD;nHlJ.components.hua_teleporter.offset=0;nHlJ.components.hua_teleporter.travelcameratime=1;nHlJ.components.hua_teleporter.travelarrivetime=0.5;nHlJ:ListenForEvent("doneteleporting",lqT)nHlJ:AddComponent("lootdropper")nHlJ.components.lootdropper:SetChanceLootTable("hua_player_house1")if TUNING.HUA_HOUSE_HAMMER==true then nHlJ:AddComponent("workable")nHlJ.components.workable:SetWorkAction(ACTIONS.HAMMER)nHlJ.components.workable:SetWorkLeft(5)nHlJ.components.workable:SetOnFinishCallback(tczrIB)nHlJ.components.workable:SetOnWorkCallback(PrPyxMK)end;nHlJ:ListenForEvent("onbuilt",a)MakeSnowCovered(nHlJ)nHlJ:WatchWorldState("phase",LB1Z)LB1Z(nHlJ,TheWorld.state.phase)nHlJ:ListenForEvent("onremove",function(nHlJ)local RfsnisO,lvW2ga,T7RKP=nHlJ.Transform:GetWorldPosition()if not RfsnisO then for _L6Bs,SH in pairs(Ents)do if SH:HasTag("multiplayer_portal")then RfsnisO,lvW2ga,T7RKP=SH.Transform:GetWorldPosition()end end end;if not RfsnisO then RfsnisO,lvW2ga,T7RKP=0,0,0 end if nHlJ.components.hua_teleporter and nHlJ.components.hua_teleporter.targetTeleporter~=nil then local wU4wYbA9=nHlJ.components.hua_teleporter.targetTeleporter local fFeQcIM,JEHSHPh3,bb=wU4wYbA9.Transform:GetWorldPosition()local o5e6fP=TheSim:FindEntities(fFeQcIM,0,bb,20,nil,{"INLIMBO"})for iq7ol,eMV in ipairs(o5e6fP)do if eMV:HasTag("player")or eMV:HasTag("irreplaceable")or eMV.components.health~=nil then qW0lRiD1(eMV,RfsnisO,lvW2ga,T7RKP,true)elseif eMV.components.workable~=nil then eMV.components.workable:Destroy(eMV)elseif eMV.components.perishable~=nil then eMV.components.perishable:LongUpdate(10000)elseif eMV.components.finiteuses~=nil then eMV.components.finiteuses:Use(10000)elseif eMV.components.fueled~=nil then eMV.components.fueled:DoUpdate(10000)end end;TheWorld:DoTaskInTime(0.5,function(WDTNkTD)local Oejsws=TheSim:FindEntities(fFeQcIM,0,bb,20)for CkD73N0,PlwhaRKJ in ipairs(Oejsws)do if PlwhaRKJ and PlwhaRKJ.components.inventoryitem~=nil then qW0lRiD1(PlwhaRKJ,RfsnisO,lvW2ga,T7RKP)else PlwhaRKJ:Remove()end end end)end end)nHlJ.OnSave=iD1IUx;nHlJ.OnLoad=JLCOx_ak;return nHlJ end;local function NsoTwDs(Caz4NM4Z)Caz4NM4Z.Transform:SetScale(0.9,0.9,0.9)Caz4NM4Z.AnimState:HideSymbol("boards")Caz4NM4Z.AnimState:HideSymbol("snow")end;return Prefab("hua_player_house1",R1FIoQI,q,kP7O5),MakePlacer("hua_player_house1_placer","hua_house1","hua_house1","idle",nil,nil,nil,nil,nil,nil,NsoTwDs)